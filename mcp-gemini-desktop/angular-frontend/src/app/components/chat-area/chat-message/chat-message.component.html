<div class="message-wrapper-material" [ngClass]="message?.sender">
    <mat-card [ngClass]="{
    'user-message-card': message?.sender === 'user',
    'ai-message-card': message?.sender === 'ai',
    'system-message-card': isSystemMessage()
  }">
        <!-- System Message / Tool Status -->
        <mat-card-content *ngIf="isSystemMessage()">
            <details class="message-details-material" [open]="isDetailsOpen()">
                <summary class="message-summary-material" [style.color]="getSummaryColor()">
                    <mat-icon>{{ getSummaryIconName() }}</mat-icon>
                    {{ getSummaryText() }}
                </summary>
                <div class="message-details-content-material"
                    [style.overflow-wrap]="isToolStatusMessage() ? 'break-word' : 'normal'">
                    <div *ngIf="message.type !== 'tool_request'">
                        {{ getDetailsContent() }}
                    </div>
                    <div *ngIf="message.type === 'tool_request'" class="tool-request-container">
                        <div *ngFor="let toolCall of message.tool_calls" class="tool-call-details">
                            <strong>Tool:</strong> {{ toolCall.name }}<br>
                            <strong>Arguments:</strong>
                            <pre>{{ toolCall.args | json }}</pre>
                            <div class="tool-request-actions">
                                <button mat-button color="primary" (click)="onToolResponse(true, toolCall)">Allow</button>
                                <button mat-button color="warn" (click)="onToolResponse(false, toolCall)">Deny</button>
                            </div>
                        </div>
                    </div>
                </div>
            </details>
        </mat-card-content>

        <!-- AI or User Message -->
        <mat-card-content *ngIf="!isSystemMessage() && message.type !== 'tool_request'" class="message-content-material"
            [innerHTML]="getFormattedContent()">
            <!-- Content will be rendered here by [innerHTML] -->
        </mat-card-content>
    </mat-card>
</div>